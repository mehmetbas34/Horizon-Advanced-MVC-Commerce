@model HorizonShop.Models.Order

@{
    ViewBag.Title = "Checkout";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var cartItems = ViewBag.CartItems as List<HorizonShop.Models.CartItem>;
}

<main class="container con-1">

    <section class="page-hero">
        <h1>Checkout</h1>
        <p>Complete your order details.</p>
    </section>

    <section>
        @using (Html.BeginForm("PlaceOrder", "Checkout", FormMethod.Post))
        {
            @Html.AntiForgeryToken()

            <div class="checkout-grid">

                <div class="contact-card crud-form-container" style="margin:0; max-width:none;">
                    <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:15px;">Billing Details</h3>

                    <div class="form-horizontal">

                        <div class="form-group">
                            <label class="form-label">Shipping Address</label>
                            <div class="col-md-10">
                                @Html.TextAreaFor(model => model.ShippingAddress, new { @class = "form-control-custom", rows = "3", placeholder = "Street address..." })
                                @Html.ValidationMessageFor(model => model.ShippingAddress, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div style="display:flex; gap:20px; margin-top:15px;">
                            <div style="flex:1;">
                                <label class="form-label">Town / City</label>
                                @Html.TextBoxFor(model => model.City, new { @class = "form-control-custom" })
                                @Html.ValidationMessageFor(model => model.City, "", new { @class = "text-danger" })
                            </div>
                            <div style="flex:1;">
                                <label class="form-label">Zip Code</label>
                                @Html.TextBoxFor(model => model.ZipCode, new { @class = "form-control-custom" })
                                @Html.ValidationMessageFor(model => model.ZipCode, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div class="form-group" style="margin-top:15px;">
                            <label class="form-label">Phone</label>
                            <div class="col-md-10">
                                @Html.TextBoxFor(model => model.Phone, new { @class = "form-control-custom" })
                                @Html.ValidationMessageFor(model => model.Phone, "", new { @class = "text-danger" })
                            </div>
                        </div>

                        <div style="margin-top:30px;">
                            <h4 style="margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">Payment Details</h4>

                            <div style="background:#f8f9fa; padding:20px; border:1px solid #eee; border-radius:4px;">

                                <div class="form-group">
                                    <label class="form-label">Card Holder Name</label>
                                    <input type="text" name="CardHolderName" class="form-control-custom" placeholder="Name on card" required />
                                </div>

                                <div class="form-group" style="margin-top:15px;">
                                    <label class="form-label">Card Number</label>
                                    <input type="text" name="CardNumber" class="form-control-custom" placeholder="0000 0000 0000 0000" maxlength="19" required />
                                </div>

                                <div style="display:flex; gap:20px; margin-top:15px;">
                                    <div style="flex:1;">
                                        <label class="form-label">Expiry Month</label>
                                        <select name="ExpiryMonth" class="form-control-custom" required>
                                            <option value="">Month</option>
                                            @for (int i = 1; i <= 12; i++)
                                            {
                                                <option value="@i">@i.ToString("00")</option>
                                            }
                                        </select>
                                    </div>
                                    <div style="flex:1;">
                                        <label class="form-label">Expiry Year</label>
                                        <select name="ExpiryYear" class="form-control-custom" required>
                                            <option value="">Year</option>
                                            @for (int i = 2025; i <= 2035; i++)
                                            {
                                                <option value="@i">@i</option>
                                            }
                                        </select>
                                    </div>
                                    <div style="flex:1;">
                                        <label class="form-label">CVV</label>
                                        <input type="text" name="CVV" class="form-control-custom" placeholder="123" maxlength="3" required />
                                    </div>
                                </div>

                                <div style="margin-top:15px; display:flex; align-items:center; gap:10px; color:#666; font-size:13px;">
                                    <i class="fas fa-lock"></i> Your payment info is stored securely (Simulated).
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="contact-card">
                    <h3 style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:15px;">Your Order</h3>

                    <table class="table" style="width:100%; margin-bottom:20px;">
                        <thead>
                            <tr style="border-bottom:2px solid #eee;">
                                <th style="text-align:left; padding:10px 0; color:#666;">Product</th>
                                <th style="text-align:right; padding:10px 0; color:#666;">Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (cartItems != null)
                            {
                                foreach (var item in cartItems)
                                {
                                    <tr style="border-bottom:1px solid #f5f5f5;">
                                        <td style="padding:10px 0; font-size:14px;">
                                            @item.Product.Name <strong style="color:#333;">× @item.Quantity</strong>
                                        </td>
                                        <td style="text-align:right; padding:10px 0; font-weight:bold;">
                                            $@(item.Product.Price * item.Quantity)
                                        </td>
                                    </tr>
                                }
                            }
                        </tbody>
                        <tfoot>
                            <tr style="border-top:2px solid #eee;">
                                <td style="padding:15px 0; font-weight:bold;">Subtotal</td>
                                <td style="text-align:right; padding:15px 0; font-weight:bold;">$@ViewBag.Subtotal</td>
                            </tr>
                            <tr>
                                <td style="padding:5px 0; font-weight:bold;">Shipping</td>
                                <td style="text-align:right; padding:5px 0; font-weight:bold;">$@ViewBag.Shipping</td>
                            </tr>
                            <tr style="font-size:20px;">
                                <td style="padding:15px 0; font-weight:bold;">Total</td>
                                <td style="text-align:right; padding:15px 0; font-weight:bold; color:#ffd333;">$@ViewBag.Total</td>
                            </tr>
                        </tfoot>
                    </table>

                    <button type="submit" class="btn-submit" style="width:100%; padding:15px; font-size:16px;">
                        Place Order
                    </button>
                </div>

            </div>
        }
    </section>
</main>

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}